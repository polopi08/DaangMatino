import { URL } from 'url'
import Dispatcher from './dispatcher'
import buildConnector from './connector'

type H2ClientOptions = Omit<Dispatcher.ConnectOptions, 'origin'>

/**
 * A basic H2C client, mapped on top a single TCP connection. Pipelining is disabled by default.
 */
export class H2CClient extends Dispatcher {
  constructor (url: string | URL, options?: H2CClient.Options)
  
  pipelining: number
  
  closed: boolean
  
  destroyed: boolean

  
  override connect (
    options: H2ClientOptions
  ): Promise<Dispatcher.ConnectData>
  override connect (
    options: H2ClientOptions,
    callback: (err: Error | null, data: Dispatcher.ConnectData) => void
  ): void
}

export declare namespace H2CClient {
  export interface Options {
    
    maxHeaderSize?: number;
    
    headersTimeout?: number;
    
    connectTimeout?: number;
    
    bodyTimeout?: number;
    
    keepAliveTimeout?: number;
    
    keepAliveMaxTimeout?: number;
    
    keepAliveTimeoutThreshold?: number;
    
    socketPath?: string;
    
    pipelining?: number;
    
    strictContentLength?: boolean;
    
    maxCachedSessions?: number;
    
    maxRedirections?: number;
    
    connect?: Omit<Partial<buildConnector.BuildOptions>, 'allowH2'> | buildConnector.connector;
    
    maxRequestsPerClient?: number;
    
    localAddress?: string;
    
    maxResponseSize?: number;
    
    autoSelectFamily?: boolean;
    
    autoSelectFamilyAttemptTimeout?: number;
    /**
     * @description Dictates the maximum number of concurrent streams for a single H2 session. It can be overridden by a SETTINGS remote frame.
     * @default 100
    */
    maxConcurrentStreams?: number
  }
}

export default H2CClient
