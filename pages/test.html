<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DaangMatino - Road Maintenance Planning System</title>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../assets/testPageStyle.css">
</head>
<body>
    <header class="header-sticky"> 
        <a href="landingPage.html" class="logo">
            <img src="../assets/logowDAA.png" alt="Company Logo">
            DaangMatino 
        </a>
        <!-- <ul class="navbar">
            <li><a href="#home" class="active">Home</a></li>
            <li><a href="#features">Features</a></li>
            <li><a href="#about">About Us</a></li>
            <li><a href="#contact">Contact</a></li>
            <li><a href="maps.html">Maps</a></li>
        </ul> -->
        <div class="nav-actions">
            <div class="reportButton">
                <a href="landingPage.html"><button>Back to Home</button></a> 
                <!-- <a href="adminPage.html"><button>Admin Dashboard</button></a> -->
            </div>
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>

    <div class="container">

        <div class="tabs">
            <div class="tab active" onclick="switchTab('report')">
                üìã Report Defects
            </div>
            <div class="tab" onclick="switchTab('analysis')">
                üî¨ Analysis & Prioritization
            </div>
        </div>

        <!-- Report Tab -->
        <div id="report-tab" class="tab-content active">
            <div class="report-form">
                <h3>üö® Report Road Defect</h3>
                <div class="form-grid">
                    <div class="input-group">
                        <label for="roadName">Road Name/Location</label>
                        <input
                            type="text"
                            id="roadName"
                            placeholder="Select nodes on map"
                            readonly
                        />
                    </div>
                    <div class="input-group">
                        <label for="detectedRoadType">Detected Road Type</label>
                        <input
                            type="text"
                            id="detectedRoadType"
                            placeholder="Will be detected from OSM"
                            readonly
                        />
                    </div>
                    <div class="input-group">
                        <label for="responseTime">Estimated Response Time (days)</label>
                        <input
                            type="number"
                            id="responseTime"
                            min="1"
                            value="0"
                            readonly
                        />
                    </div>

                <div class="input-group" style="grid-column: 1 / -1">
                    <label>Defect Types (Select all that apply)</label>
                    <div class="defects-container" id="defectsContainer">
                        <!-- Defect checkboxes will be generated here -->
                    </div>
                </div>

                <!-- Map Container -->
                <div id="mapContainer">
                    <div class="map-overlay">
                        <h4>OSM Road Selection</h4>
                        <div id="selectionInfo" class="selection-info">
                            Click "Select Nodes" to start
                        </div>
                        <div class="map-controls">
                            <button
                                id="pointBtn"
                                class="map-control-btn active"
                                onclick="setMode('node')"
                            >
                                üìç Select Nodes
                            </button>
                            <button
                                class="map-control-btn btn-danger"
                                onclick="clearSelection()"
                            >
                                ‚ùå Clear Selection
                            </button>
                        </div>
                        <p style="margin-top: 10px; font-size: 0.9em">
                            <span class="node-marker"></span> = Node
                            <span class="route-line"></span> = Road Segment
                        </p>
                    </div>
                    <div id="map"></div>
                </div>

                <button
                    class="btn-primary"
                    onclick="submitReport()"
                    style="margin-top: 20px"
                >
                    Submit Report
                </button>
            </div>
        </div>
            <div class="reports-table">
                <h3
                    style="
                        padding: 20px;
                        margin: 0;
                        background: #f8f9fa;
                        border-bottom: 1px solid #e0e6ed;
                    "
                >
                    üìä Community Reports
                </h3>
                <table>
                    <thead>
                        <tr>
                            <th>Road Name</th>
                            <th>Type</th>
                            <th>Defects</th>
                            <th>Response Time</th>
                            <th>Date Created</th>
                        </tr>
                    </thead>
                    <tbody id="reportsBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                No reports submitted yet. Be the first to report a road
                                defect!
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analysis Tab -->
        <div id="analysis-tab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="totalReports">0</div>
                    <div class="stat-label">Total Reports</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="criticalIssues">0</div>
                    <div class="stat-label">Critical Issues</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avgResponseTime">0</div>
                    <div class="stat-label">Avg Response Time (days)</div>
                </div>
                <!-- <div class="stat-item">
                    <div class="stat-number" id="budgetUtilization">0%</div>
                    <div class="stat-label">Budget Utilization</div>
                </div> -->
            </div>

            <!-- Most Reported Roads Section -->
            <div class="most-reported-section" style="margin: 30px 0;">
                <h3 style="margin-bottom: 20px; color: #212529;">üìä Most Reported Roads (Aggregated Severity)</h3>
                <div id="mostReportedRoads" class="most-reported-container">
                    <div class="loading">Loading most reported roads...</div>
                </div>
            </div>

            <div style="margin: 30px 0">
                <label
                    for="maintenanceBudget"
                    style="display: block; margin-bottom: 10px; font-weight: 600"
                    >Available Maintenance Time (days):</label
                >
                <input
                    type="number"
                    id="maintenanceBudget"
                    value="180"
                    min="1"
                    style="width: 200px; margin-right: 20px"
                />
                <button class="btn-success" onclick="runOptimization()">
                    üöÄ Run DaangMatino Analysis
                </button>
            </div>

            <div
                class="algorithm-results"
                id="algorithmResults"
                style="display: none"
            >
                <!-- Knapsack Results -->
                <div class="result-panel knapsack-panel">
                    <h3>üéí Knapsack Optimization</h3>
                    <p>
                        <strong>Purpose:</strong> Select optimal subset of roads that can
                        be fixed within available time budget
                    </p>
                    <div id="knapsackResults"></div>
                </div>

                <!-- QuickSort Results -->
                <div class="result-panel quicksort-panel">
                    <h3>‚ö° QuickSort Prioritization</h3>
                    <p>
                        <strong>Purpose:</strong> Sort selected roads by priority
                        considering severity, type of road, and community impact
                    </p>
                    <div id="quicksortResults"></div>
                </div>

                <!-- Dijkstra Results -->
                <div class="result-panel dijkstra-panel">
                    <h3>üó∫Ô∏è Dijkstra Route Planning</h3>
                    <p>
                        <strong>Purpose:</strong> Find optimal alternative routes during
                        maintenance periods
                    </p>
                    <div id="dijkstraResults"></div>
                    <div id="distanceInfo" class="distance-container">
                            <p>No nodes selected yet. Click on the map to add nodes.</p>
                    </div>
                </div>
            </div>

            <!-- Maintenance Schedule -->
            <div id="maintenanceSchedule" class="empty-state">
                Run the DaangMatino analysis first to generate maintenance schedules.
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../jscript/supabaseClient.js?v=2.0"></script>
    <script src="../jscript/testPageScript.js?v=9.4"></script>

</body>
</html>